
# Is this a place?

A game of deciding which places are real, and which have been generated by a neural network.

To play, go to: https://adamnellis.github.io/is-this-a-place/


## To deploy

Push changes to the `gh-pages` branch, to deploy to GitHub Pages.


## To Run locally

To run locally, we need to use a local web server, for the ajax requests to work when loading Vue
(because of CORS restrictions for local files).

Express is a simple web server that doesn't take much setup:

* `npm install express`
* `node -e "require('express')().use(require('express').static(__dirname, {index:'index.html'})).listen(8181)"`


## To train the network

1. Download the data file for your preferred country from GeoNames http://download.geonames.org/export/dump/
2. Select the entries you want from that file, using your preferred method
    * I used Microsoft Excel to filter only the places (`feature class == P`)
3. Save the `asciiname` column to a separate file
    * Each place name is on a separate line in this file
    * e.g. the file `english-places.txt` in this repository
4. Run the `train_from_scratch()` function in `char_rnn.py`
    * Use your prepared data file as the `data_file` parameter
    * Choose a new name for the `save_folder` parameter. This is the directory into which the saved weights will be written.

I trained a separate network for each country. 
Each was trained for around 24 hours on my Intel i5-4460s CPU (2.90 GHz).
This managed around 14 million iterations. 
I'm not certain that this much training is necessary.
I could see very believable answers coming out within minutes.
I trained for this long in an attempt to reduce the false positive rate. 


## To use the trained network in the website

There are two different ways to run the website:

1. Using the API.
2. Using a word list.

### Using the API

I've not deployed a version of this website using the API, so some work is necessary to make this run.
The process is:

1. In `app.vue`, create a new `country_data` data item for your new country
    * Set the `rnn_name` to be the `save_folder` from your training
    * Set the `rnn_iteration_number` to be the saved iteration you wish to use
        * This must be a valid iteration number, with a corresponding folder under `save_folder/weights`
    * Add a flag image to the `static` directory, with the same format as the others
2. In `app.vue::get_new_words()`, make sure the section for using the API is uncommented, and the section for using the word list is commented out.
3. Deploy all the files to your web server, including the directory of saved weights
4. Run Flask, using the Flask app defined in `rnn_api.py`
    * Probably need to comment out the `app.run()` call at the end of this file, or wrap it in a condition
    * Probably best to use a wsgi server to run Flask
   * Probably turn off debug mode - set at the top of `rnn_api.py`

### Using the word list

This is the way in which this website is deployed on GitHub pages.
In order to add a new country that has been previously trained:

1. Using `char_rnn.py`, run `generate_fake_words_to_file()` and `generate_real_words_to_file()` to generate the two word lists.
    * See examples at the bottom of `char_rnn.py`
    * This creates word lists as `.js` files that define a variable with a hardcoded word list.
    * Move these two files into the `static` directory.
2. Modify `index.html` to include these two word lists alongside the existing ones.
3. In `app.vue`, create a new `country_data` data item for your new country
    * Set the `rnn_name` to be the variable name in the fake names file. 
        * This is the same as the `save_folder` from your training
    * Set the `real_name` to be the variable name in the real names file.
        * This is the same as the `save_folder` from your training, with `rnn` replaced with `real`
    * Add a flag image to the `static` directory, with the same format as the others
 4. Deploy the following files to your web server:
    * `index.html`
    * `static/*`
